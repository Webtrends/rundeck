##############################################################################
# This file is autogenerated by chef                                         #
#                                                                            #
# Collectd Kafka Producer plugin configuration file                          #
#----------------------------------------------------------------------------#
# By: Josh Behrends - Webtrends 2012                                         #
#                                                                            #
# Revisions: 06/11/2012 - Initial script creation                            #
#            06/21/2012 - Added JVM stats, and logreplay metrics             #
#                                                                            #
##############################################################################
LoadPlugin java

<Plugin "java">
        JVMArg "-verbose:jni"
        JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"
        LoadPlugin "org.collectd.java.GenericJMX"
        <Plugin "GenericJMX">
        ################
        # MBean blocks #
        ################
				# Memory usage by memory pool.
		<MBean "memory_pool">
			ObjectName "java.lang:type=MemoryPool,*"
			InstancePrefix "memory_pool_"
			InstanceFrom "name"
			<Value>
				Type "memory"
				Table true
				Attribute "Usage"
			</Value>
		</MBean>
		# Heap memory usage
		<MBean "memory_heap">
			ObjectName "java.lang:type=Memory"
			InstancePrefix "memory_heap"
			# Creates four values: committed, init, max, used
			<Value>
				Type "memory"
				Table true
				Attribute "HeapMemoryUsage"
			</Value>
		</MBean>
		# Non-heap memory usage
		<MBean "memory_nonheap">
			ObjectName "java.lang:type=Memory"
			InstancePrefix "memory_nonheap"
			# Creates four values: committed, init, max, used
			<Value>
				Type "memory"
				Table true
				Attribute "NonHeapMemoryUsage"
			</Value>
		</MBean>
		# Non-heap memory usage
		<MBean "java_threads">
			ObjectName "java.lang:type=Threading"
			InstancePrefix "java_threads"
			<Value>
				Type "gauge"
				InstancePrefix "ThreadCount"
				Attribute "ThreadCount"
			</Value>
		</MBean>
		# Garbage Collector stats
		<MBean "garbage_collector">
			ObjectName "java.lang:type=GarbageCollector,*"
			InstancePrefix "gc_"
			InstanceFrom "name"
			<Value>
				Type "invocations"
				InstancePrefix "collection_count"
				Table false
				Attribute "CollectionCount"
			</Value>
			<Value>
				Type "total_time_in_ms"
				InstancePrefix "collection_time"
				Table false
				Attribute "CollectionTime"
			</Value>
		</MBean>
		# Number of classes being loaded.
		<MBean "classes">
			ObjectName "java.lang:type=ClassLoading"
			InstancePrefix "loaded_classes"
			<Value>
				Type "gauge"
				InstancePrefix "loaded_classes"
				Table false
				Attribute "LoadedClassCount"
			</Value>
		</MBean>
		# java runtime attributes
		<MBean "runtime">
			ObjectName "java.lang:type=Runtime"
			InstancePrefix "runtime"
			<Value>
				Type "gauge"
				InstancePrefix "JVM_uptime"
				Table false
				Attribute "Uptime"
			</Value>
		</MBean>
		#Kafka Metrics
        <MBean "kafka_sync">
                ObjectName "kafka:type=kafka.KafkaProducerStats"
                InstancePrefix "KAFKA_producer_stats"
                <Value>
                        Type "gauge"
                        InstancePrefix "AvgProduceRequestMs"
                        Table false
                        Attribute "AvgProduceRequestMs"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "MaxProduceRequestMs"
                        Table false
                        Attribute "MaxProduceRequestMs"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "NumProduceRequests"
                        Table false
                        Attribute "NumProduceRequests"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "ProduceRequestsPerSecond"
                        Table false
                        Attribute "ProduceRequestsPerSecond"
                </Value>
        </MBean>
        <MBean "kafka_async">
                ObjectName "kafka.producer.Producer:type=AsyncProducerStats"
                InstancePrefix "KAFKA_async_producer_stats"
                <Value>
                        Type "gauge"
                        InstancePrefix "AsyncProducerEvents"
                        Table false
                        Attribute "AsyncProducerEvents"
                </Value>
        </MBean>
        #Metrics
        <MBean "active_dcsid">
			ObjectName "logreplayer:type=config,name=active-dcsid"
			InstancePrefix "LR_active_dcsid"
			<Value>
				Type "gauge"
				InstancePrefix "Value"
				Table false
				Attribute "Value"
			</Value>
	    </MBean>
        <MBean "files_in_queue">
			ObjectName "logreplayer:type=filemover,name=files-in-queue"
			InstancePrefix "LR_files_in_queue"
			<Value>
				Type "gauge"
				InstancePrefix "Value"
				Table false
				Attribute "Value"
			</Value>
        </MBean>
        <MBean "hits_accepted">
                ObjectName "logreplayer:type=logconsumer,name=hits-accepted"
                InstancePrefix "LR_hits_accepted"
                <Value>
                        Type "gauge"
                        InstancePrefix "Count"
                        Table false
                        Attribute "Count"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "MeanRate"
                        Table false
                        Attribute "MeanRate"
                </Value>
        </MBean>
        <MBean "hits_per_log_file">
                ObjectName "logreplayer:type=logconsumer,name=hits-per-log-file"
                InstancePrefix "LR_hits_per_log_file"
                <Value>
                        Type "gauge"
                        InstancePrefix "Count"
                        Table false
                        Attribute "Count"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "Max"
                        Table false
                        Attribute "Max"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "Mean"
                        Table false
                        Attribute "Mean"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "Min"
                        Table false
                        Attribute "Min"
                </Value>
        </MBean>
       <MBean "log_files_replayed">
                ObjectName "logreplayer:type=logconsumer,name=log-files-replayed"
                InstancePrefix "LR_log_files_replayed"
                <Value>
                        Type "gauge"
                        InstancePrefix "Count"
                        Table false
                        Attribute "Count"
                </Value>
                <Value>
                        Type "gauge"
                        InstancePrefix "MeanRate"
                        Table false
                        Attribute "MeanRate"
                </Value>
        </MBean>
        #####################
        # Connection blocks #
        #####################
        #Connection Block
        <Connection>
			Host "<%= @node[:hostname] %>"
			ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:<%= @node['wt_streaminglogreplayer']['jmx_port'] %>/jmxrmi"
			Collect "classes"
			Collect "garbage_collector"
			Collect "java_threads"
			Collect "memory_heap"
			Collect "memory_nonheap"
			Collect "runtime"
			Collect "kafka_sync"
			Collect "kafka_async"
			Collect "active_dcsid"
			Collect "files_in_queue"
			Collect "hits_accepted"
			Collect "hits_per_log_file"
			Collect "log_files_replayed"
        </Connection>
    </Plugin>
</Plugin>
