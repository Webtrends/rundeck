<?xml version="1.0" encoding="utf-8"?>
<configuration>
<configSections>
   <section name="cacheConfiguration" type="Webtrends.Cache.Configuration.CacheConfigurationSection, Webtrends.Cache2" />
   <section name="CassandraCluster" type="Webtrends.Cassandra.Core.CassandraClusterConfigSection, Webtrends.Cassandra.Core" />
   <section name="serviceBus" type="Webtrends.ServiceBus.Configuration.ServiceBusConfiguration, Webtrends.ServiceBus" />
 </configSections>
 
 <!-- Start Cache settings -->
 <cacheConfiguration enabled="<%= @cache_enabled %>" region="<%= @cache_region %>" lifespan="00:15:00"
   protocol="Binary">
   <servers>
     <clear />
          <% @cache_hosts.each do |cache| -%>
          <add address="<%= cache['name']%>" port="<%= cache['port']%>" />
          <% end -%>
   </servers>
 </cacheConfiguration>
 <!-- End Cache settings -->
 
 <!-- Start ServiceBus endpoint -->
 <serviceBus>
   <endpoints>
     <endpoint endpointIdentifier="serviceBusUIMain@localhost" name="Webtrends Insight UI" binding="mainBinding" returnAddress="serviceBusUIMain@localhost" poisonMessageAddress="serviceBusUIError@localhost" maxMessageRetryCount="3" numberOfWorkerThreads="12" maxRetries="4" statusReportInterval="00:00:30" statusReportGracePeriod="00:01:00" monitorServiceAddress="serviceBusMonitoring@<%= @monitor_host %>" incomingMessageLoggingLevel="None" outgoingMessageLoggingLevel="None" sendOnly="false">
 
       <profiler enabled="true" profilePipelineComponents="true" pipelineDirection="Both" />
 
       <!-- Register to handle the following messages -->
       <registeredMessages>
       </registeredMessages>
 
       <!-- Register the message handlers -->
       <messageHandlerAssemblies>
         <assembly name="Webtrends.ServiceBus" />
        </messageHandlerAssemblies>
 
       <statusProbes>
         <probe name="Available Memory" unitOfMeasurement="mb" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="Memory" />
             <add name="Counter" value="Available MBytes" />
             <add name="Instance" value="" />
           </properties>
         </probe>
         <probe name="Avg. Processor Time" unitOfMeasurement="%" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="Processor" />
             <add name="Counter" value="% Processor Time" />
             <add name="Instance" value="_Total" />
           </properties>
         </probe>
         <probe name="Messages in Queue" unitOfMeasurement="messages" canAggregate="true" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="MSMQ Queue" />
             <add name="Counter" value="Messages in Queue" />
             <!-- The term 'localhost' will be converted to the machine name -->
             <add name="Instance" value="localhost\private$\servicebusmain" />
           </properties>
         </probe>
         <probe name="Private Bytes (process)" unitOfMeasurement="bytes" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="Process" />
             <add name="Counter" value="Private Bytes" />
             <add name="Instance" value="w3wp" />
           </properties>
         </probe>
         <probe name="Virtual Bytes (process)" unitOfMeasurement="bytes" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="Process" />
             <add name="Counter" value="Virtual Bytes" />
             <add name="Instance" value="w3wp" />
           </properties>
         </probe>
 
         <probe name="Application Restarts" unitOfMeasurement="restarts" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="ASP.NET" />
             <add name="Counter" value="Application Restarts" />
             <add name="Instance" value="" />
           </properties>
         </probe>
         <probe name="Requests Queued" unitOfMeasurement="requests" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="ASP.NET" />
             <add name="Counter" value="Requests Queued" />
             <add name="Instance" value="" />
           </properties>
         </probe>
         <probe name="Worker Process Restarts" unitOfMeasurement="restarts" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="ASP.NET" />
             <add name="Counter" value="Worker Process Restarts" />
             <add name="Instance" value="" />
           </properties>
         </probe>
 
         <probe name="Errors" unitOfMeasurement="errors" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="ASP.NET Applications" />
             <add name="Counter" value="Errors Total" />
             <add name="Instance" value="__Total__" />
           </properties>
         </probe>
         <probe name="Requests / Sec" unitOfMeasurement="requests" canAggregate="false" dataType="Numeric" type="Webtrends.ServiceBus.Endpoint.Management.Monitoring.PerfCounterProbe, Webtrends.ServiceBus">
           <properties>
             <add name="Category" value="ASP.NET Applications" />
             <add name="Counter" value="Requests/Sec" />
             <add name="Instance" value="__Total__" />
           </properties>
         </probe>
       </statusProbes>
 
     </endpoint>
   </endpoints>
   <bindings>
     <msmqBinding name="mainBinding" purgeOnStartup="false" isTransactional="true" transactionTimeout="00:02:00" isolationLevel="Serializable" />
   </bindings>
 </serviceBus>
 <!-- End ServiceBus endpoint -->
 
  <CassandraCluster KeySpace="Webtrends" ReportColumnFamily="<%= @cass_report_column %>"
   MetaDataColumnFamily="<%= @cass_metadata_column %>" ThriftPort="<%= @cass_thrift_port %>" UseLegacy="false">
   <Nodes>
     <clear />
     <add Hostname="<%= @cass_host %>" />
   </Nodes>
 </CassandraCluster>
 
 <appSettings>
   <!-- This is the path to the log4net config file -->
   <add key="log4net.Config" value="log4net.config" />
   <!-- For the ServiceBus architecture is this installation managed. If this is not defined
   then it will default to false. This should be defined and set to false for development machines. -->
<add key="StaticContentUrl" value "<%= @static_content_url %>" />  
 <add key="ServiceBusManaged" value="true" />
  <add key="ActionCenterPublicKey" value="<%= @actioncenter_public_key %>" />   
 </appSettings>
  
 <runtime>
   <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
     <dependentAssembly>
       <assemblyIdentity name="Autofac" publicKeyToken="17863af14b0044da" culture="neutral" />
       <bindingRedirect oldVersion="0.0.0.0-2.6.3.862" newVersion="2.6.3.862" />
     </dependentAssembly>
     <dependentAssembly>
       <assemblyIdentity name="System.ServiceModel" publicKeyToken="b77a5c561934e089" culture="neutral" />
       <bindingRedirect oldVersion="0.0.0.0-4.0.0.0" newVersion="4.0.0.0" />
     </dependentAssembly>
     <dependentAssembly>
       <assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35" culture="neutral" />
       <bindingRedirect oldVersion="0.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
     </dependentAssembly>
     <dependentAssembly>
       <assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" culture="neutral" />
       <bindingRedirect oldVersion="0.0.0.0-4.5.11" newVersion="4.5.11" />
     </dependentAssembly>
     <dependentAssembly>
       <assemblyIdentity name="System.ServiceModel.Web" publicKeyToken="31bf3856ad364e35" culture="neutral" />
       <bindingRedirect oldVersion="0.0.0.0-4.0.0.0" newVersion="4.0.0.0" />
     </dependentAssembly>
     <dependentAssembly>
       <assemblyIdentity name="Castle.Core" publicKeyToken="407dd0808d44fbdc" culture="neutral" />
       <bindingRedirect oldVersion="0.0.0.0-3.0.0.0" newVersion="3.1.0.0" />
     </dependentAssembly>
   </assemblyBinding>
 </runtime>
 
 <system.web>
  <compilation debug="true" targetFramework="4.0" />
    <globalization culture="auto" uiCulture="auto" />
    <authentication mode="None" />
    <pages>
      <namespaces>
        <add namespace="System.Web.Helpers" />
        <add namespace="System.Web.Mvc" />
        <add namespace="System.Web.Mvc.Ajax" />
        <add namespace="System.Web.Mvc.Html" />
        <add namespace="System.Web.Optimization" />
        <add namespace="System.Web.Routing" />
        <add namespace="System.Web.WebPages" />
      </namespaces>
    </pages>
    <profile defaultProvider="DefaultProfileProvider">
      <providers>
        <add name="DefaultProfileProvider" type="System.Web.Providers.DefaultProfileProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" connectionStringName="DefaultConnection" applicationName="/" />
      </providers>
    </profile>
    <membership defaultProvider="DefaultMembershipProvider">
      <providers>
        <add name="DefaultMembershipProvider" type="System.Web.Providers.DefaultMembershipProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" connectionStringName="DefaultConnection" enablePasswordRetrieval="false" enablePasswordReset="true" requiresQuestionAndAnswer="false" requiresUniqueEmail="false" maxInvalidPasswordAttempts="5" minRequiredPasswordLength="6" minRequiredNonalphanumericCharacters="0" passwordAttemptWindow="10" applicationName="/" />
      </providers>
    </membership>
    <roleManager defaultProvider="DefaultRoleProvider">
      <providers>
        <add name="DefaultRoleProvider" type="System.Web.Providers.DefaultRoleProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" connectionStringName="DefaultConnection" applicationName="/" />
      </providers>
    </roleManager>
    <sessionState mode="InProc" customProvider="DefaultSessionProvider">
      <providers>
        <add name="DefaultSessionProvider" type="System.Web.Providers.DefaultSessionStateProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" connectionStringName="DefaultConnection" />
      </providers>
    </sessionState>
 </system.web>
 <!--
       The system.webServer section is required for running ASP.NET AJAX under Internet
       Information Services 7.0.  It is not necessary for previous version of IIS.
 -->
 <connectionStrings>
     <add connectionString="server=<%= @master_host %>;Trusted_connection=yes;Timeout=15" name="wtMasterconnection" providerName="System.Data.SqlClient" />
 </connectionStrings>
 <system.webServer>
    <validation validateIntegratedModeConfiguration="false" />
    <modules runAllManagedModulesForAllRequests="true" />
    <handlers>
      <remove name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" />
      <remove name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" />
      <remove name="ExtensionlessUrlHandler-Integrated-4.0" />
      <add name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv4.0,bitness32" responseBufferLimit="0" />
      <add name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv4.0,bitness64" responseBufferLimit="0" />
      <add name="ExtensionlessUrlHandler-Integrated-4.0" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" type="System.Web.Handlers.TransferRequestHandler" preCondition="integratedMode,runtimeVersionv4.0" />
    </handlers>
 </system.webServer>
 <system.net>
   
 </system.net>
</configuration>
