# Generated by Chef
# host definitions

define host {
  use server
  address <%= node['ipaddress'] %>
  host_name <%= node['hostname'] %>
  hostgroups <%= node['nagios']['server_role'] %>
}

<% @nodes.each do |n| -%>
<% unless n.name == node.name -%>
define host {
  use server
	address <%= n['ipaddress'] %>
	host_name <%= n['hostname'] %>
<% if node['nagios']['multi_environment_monitoring'] -%>
<% if n.run_list.roles.nil? || n.run_list.roles.length == 0 -%>
  hostgroups all,<%= n.chef_environment %>,<%= n.os %>
<% if node['nagios']['non_alerting_environments'].include?("#{n.chef_environment}") -%>
  notifications_enabled 0
<% end -%>
<% else -%>
  hostgroups <%= n.run_list.roles.to_a.join(",") %>,<%= n.chef_environment %>,<%= n.os %>
<% if node['nagios']['non_alerting_environments'].include?("#{n.chef_environment}") -%>
  notifications_enabled 0
<% end -%>
<% end -%>
<% elsif -%>
<% if n.run_list.roles.nil? || n.run_list.roles.length == 0 -%>
  hostgroups all,<%= n.os %>
<% else -%>
  hostgroups <%= n.run_list.roles.to_a.join(",") %>,<%= n.os %>
<% end -%>
<% end -%>
}
<% end -%>

<% end -%>