#!/bin/bash
TIMEOUT=$1
URL=$2
IN=`curl -m $TIMEOUT --write-out "|%{http_code}" --silent $URL`
IFS='|' read -a parts <<< "${IN}"

if [ ${#parts[@]} -lt 3 ]; then
  echo "Error making url request to [${parts[1]}] $URL"
  exit 2
elif [ ${parts[2]} != '200' ]; then
  echo "Error making url request to [${parts[2]}] $URL"
  exit 2
elif [ ${parts[0]} = 'CRITICAL' ]; then
  echo "${parts[0]}: ${parts[1]}"
  exit 2
elif [ ${parts[0]} = 'DEGRADED' ]; then
  echo "${parts[0]}: ${parts[1]}"
  exit 1
else
  echo "OK: ${parts[1]}"
  exit 0
fi
