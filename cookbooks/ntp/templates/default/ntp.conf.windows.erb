# Generated by Chef .10 for <%= node[:fqdn] %>
# Local modifications will be overwritten.
<%# See http://www.vmware.com/vmtn/resources/238 p. 23 for explanation %>
driftfile <%= node[:ntp][:driftfile] %>

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

<% node[:ntp][:peers].each do |ntppeer| -%>
	<% if node[:ipaddress] != ntppeer and node[:fqdn] != ntppeer -%>
peer <%= ntppeer %> iburst
restrict <%= ntppeer %> nomodify
  <% end -%>
<% end -%>

<%# Whether this is a client or server, we want upstream servers -%>
<% node[:ntp][:servers].each do |ntpserver| -%>
server <%= ntpserver %> iburst
restrict <%= ntpserver %> nomodify notrap noquery
<% end -%>

restrict default kod notrap nomodify nopeer noquery
restrict 127.0.0.1 nomodify
restrict -6 default kod notrap nomodify nopeer noquery
restrict -6 ::1 nomodify
