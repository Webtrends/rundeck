<?xml version="1.0"?>
<configuration>
  <configSections>
    <section name="cacheConfiguration" type="Webtrends.Cache.Configuration.CacheConfigurationSection, Webtrends.Cache2" />
    <sectionGroup name="common">
      <section name="logging" type="Common.Logging.ConfigurationSectionHandler, Common.Logging" />
    </sectionGroup>
    <section name="CassandraCluster" type="Webtrends.Cassandra.CassandraClusterConfigSection, Webtrends.Cassandra,Version=1.0.0.0, Culture=neutral"/>
  </configSections>
  <appSettings>    
    <add key="proxy" value="http://pdxproxy.netiq.dmz:8080"/>
    <add key="BrandedAccountId" value="20578,20663,9469" />
  </appSettings>
  <connectionStrings>
    <add name="wtMasterConnection" connectionString="server=pdxmaster01;Trusted_Connection=true;database=wtMaster;connection timeout=30" providerName="System.Data.SqlClient"></add>
  </connectionStrings>
  <CassandraCluster KeySpace ="Webtrends" ReportColumnFamily="01_Report" MetaDataColumnFamily="01_Meta" SnmpCommunity="wtlive" SnmpPort="1161" ThriftPort="9160">
    <Nodes>
	<add Hostname="pdxcas.netiq.dmz" />
    </Nodes>
  </CassandraCluster>
  <common>
    <logging>
      <factoryAdapter type="Common.Logging.Log4Net.Log4NetLoggerFactoryAdapter, Common.Logging.Log4net">
        <arg key="configType" value="FILE-WATCH" />
        <arg key="configFile" value="~/log4net.config" />
      </factoryAdapter>
    </logging>
  </common>
  <cacheConfiguration enabled="False" region="DX22" protocol="Binary" lifespan="00:15:00">
    <servers>
      <% @cache_hosts.each do |cache| -%>
	  	<add address="<%= cache['name'] %>" port="<%= cache['port'] %>"/>
	  <% end -%>
    </servers>
    <socketPool minPoolSize="2" maxPoolSize="100" connectionTimeout="00:00:10" receiveTimeout="00:00:05" deadTimeout="00:02:00" />
  </cacheConfiguration>
  <system.web>
    <compilation debug="true" targetFramework="4.0" />
  </system.web>

  <system.webServer>
    <modules runAllManagedModulesForAllRequests="true">
      <add name="UrlRoutingModule" type="System.Web.Routing.UrlRoutingModule, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
    </modules>
        <rewrite>
            <rules>
                <rule name="Redirect v2.1 account keymetrics request" stopProcessing="true">
                    <match url="^ReportService/keymetrics[/]*$" />
                    <action type="Redirect" url="Reporting/reports/ProfileMetrics/" />
                </rule>
                <rule name="Redirect v2.1 profile keymetrics request" stopProcessing="true">
                    <match url="^ReportService/keymetrics/([0-9a-zA-Z]+)[/]*$" />
                    <action type="Redirect" url="Reporting/profiles/{R:1}/reports/ProfileMetrics/" />
                </rule>
                <rule name="Redirect v2.1 report request" stopProcessing="true">
                    <match url="^ReportService/profiles/([0-9a-zA-Z]+)/reports/([0-9a-zA-Z]+)[/]*$" />
                    <action type="Redirect" url="Reporting/profiles/{R:1}/reports/{R:2}/" />
                </rule>
                <rule name="Redirect v2.1 syndication request" stopProcessing="true">
                    <match url="^SyndicationService[/]*$" />
                    <action type="Redirect" url="Syndication/" />
                </rule>
            </rules>
        </rewrite>
  </system.webServer>
  <system.serviceModel>
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true"/>
    <standardEndpoints>
      <webHttpEndpoint>
        <!-- 
            Configure the WCF REST service base address via the global.asax.cs file and the default endpoint 
            via the attributes on the <standardEndpoint> element below
        -->
        <standardEndpoint name="" helpEnabled="true" automaticFormatSelectionEnabled="false"/>
      </webHttpEndpoint>
    </standardEndpoints>

  </system.serviceModel>

</configuration>
