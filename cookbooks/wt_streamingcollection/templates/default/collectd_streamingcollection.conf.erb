##############################################################################
# This file is autogenerated by chef                                         #
#                                                                            #
# Collectd Streaming Collection plugin configuration file                    #
#----------------------------------------------------------------------------#
# By: Josh Behrends - Webtrends 2012                                         #
#                                                                            #
# Revisions: 06/11/2012 - Initial script creation                            #
#                                                                            #
##############################################################################
LoadPlugin java

<Plugin "java">
        JVMArg "-verbose:jni"
        JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"
        LoadPlugin "org.collectd.java.GenericJMX"
        <Plugin "GenericJMX">
        ################
        # MBean blocks #
        ################
        # Heap memory usage
        <MBean "sc_memory_heap">
            ObjectName "java.lang:type=Memory"
            #InstanceFrom ""
            InstancePrefix "memory-heap"
            # Creates four values: committed, init, max, used
            <Value>
                Type "memory"
                #InstancePrefix ""
                #InstanceFrom ""
                Table true
                Attribute "HeapMemoryUsage"
            </Value>
        </MBean>
        # Non-heap memory usage
        <MBean "sc_memory_nonheap">
            ObjectName "java.lang:type=Memory"
            #InstanceFrom ""
            InstancePrefix "memory-nonheap"
            # Creates four values: committed, init, max, used
            <Value>
                Type "memory"
                #InstancePrefix ""
                #InstanceFrom ""
                Table true
                Attribute "NonHeapMemoryUsage"
            </Value>
        </MBean>
        # Non-heap memory usage
        <MBean "sc_java_threads">
            ObjectName "java.lang:type=Threading"
            #InstanceFrom ""
            InstancePrefix "java_threads"
            <Value>
                Type "gauge"
                InstancePrefix "ThreadCount"
                #InstanceFrom ""
                Attribute "ThreadCount"
            </Value>
        </MBean>
        # Garbage Collector stats
        <MBean "sc_garbage_collector">
            ObjectName "java.lang:type=GarbageCollector,*"
            InstancePrefix "gc-"
            InstanceFrom "name"
            <Value>
                Type "invocations"
                InstancePrefix "collection_count"
                #InstanceFrom ""
                Table false
                Attribute "CollectionCount"
            </Value>
            <Value>
                Type "total_time_in_ms"
                InstancePrefix "collection_time"
                #InstanceFrom ""
                Table false
                Attribute "CollectionTime"
            </Value>
        </MBean>
        # Number of classes being loaded.
        <MBean "sc_classes">
            ObjectName "java.lang:type=ClassLoading"
            InstancePrefix "loaded_classes"
            #InstanceFrom ""
            <Value>
                Type "gauge"
                InstancePrefix "loaded_classes"
                #InstanceFrom ""
                Table false
                Attribute "LoadedClassCount"
            </Value>
        </MBean>
        # java runtime attributes
        <MBean "sc_runtime">
            ObjectName "java.lang:type=Runtime"
            InstancePrefix "runtime"
            #InstanceFrom ""
            <Value>
                Type "gauge"
                InstancePrefix "JVM_uptime"
                #InstanceFrom ""
                Table false
                Attribute "Uptime"
            </Value>
        </MBean>
        #WT Metrics start here
        <MBean "sc_kafka">
                ObjectName "kafka:type=kafka.KafkaProducerStats"
                InstancePrefix "KafkaProducerStats"
                #InstanceFrom ""
                <Value>
                    Type "gauge"
                    InstancePrefix "AvgProduceRequestMs"
                    #InstanceFrom ""
                    Table false
                    Attribute "AvgProduceRequestMs"
                </Value>
                <Value>
                    Type "gauge"
                    InstancePrefix "MaxProduceRequestMs"
                    #InstanceFrom ""
                    Table false
                    Attribute "MaxProduceRequestMs"
                </Value>
                <Value>
                    Type "counter"
                    InstancePrefix "NumProduceRequests"
                    #InstanceFrom ""
                    Table false
                    Attribute "NumProduceRequests"
                </Value>
                <Value>
                    Type "gauge"
                    InstancePrefix "ProduceRequestsPerSecond"
                    #InstanceFrom ""
                    Table false
                    Attribute "ProduceRequestsPerSecond"
                </Value>
        </MBean>
        <MBean "sc_async">
                ObjectName "kafka.producer.Producer:type=AsyncProducerStats"
                InstancePrefix "AsyncProducerStats"
                #InstanceFrom ""
                <Value>
                    Type "gauge"
                    InstancePrefix "AsyncProducerQueueSize"
                    #InstanceFrom ""
                    Table false
                    Attribute "AsyncProducerQueueSize"
                </Value>
        </MBean>
        <MBean "sc_kafka_router_handle_send_message_error">
            ObjectName "streamingcollection:type=kafkarouter,name=handle-send-message-error"
            InstancePrefix "Kafka_kafkarouter_"
            InstanceFrom "name"
            <Value>
                Type "gauge"
                InstancePrefix "Count"
                #InstanceFrom ""
                Table false
                Attribute "Count"
            </Value>
        </MBean>
        <MBean "sc_kafka_router_messages_sent">
            ObjectName "streamingcollection:type=kafkarouter,name=messages-sent"
            InstancePrefix "Kafka_kafkarouter_"
            InstanceFrom "name"
            <Value>
                Type "counter"
                InstancePrefix "Count"
                #InstanceFrom ""
                Table false
                Attribute "Count"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "MeanRate"
                #InstanceFrom ""
                Table false
                Attribute "MeanRate"
            </Value>
        </MBean>
        <MBean "sc_kafka_send_message">
            ObjectName "streamingcollection:type=kafkarouter,name=send-message"
            InstancePrefix "Kafka_kafkarouter_"
            InstanceFrom "name"
            <Value>
                Type "counter"
                InstancePrefix "Count"
                #InstanceFrom ""
                Table false
                Attribute "Count"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "Max"
                #InstanceFrom ""
                Table false
                Attribute "Max"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "Mean"
                #InstanceFrom ""
                Table false
                Attribute "Mean"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "MeanRate"
                #InstanceFrom ""
                Table false
                Attribute "MeanRate"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "Min"
                #InstanceFrom ""
                Table false
                Attribute "Min"
            </Value>
        </MBean>
        <MBean "sc_request_handle_request">
            ObjectName "streamingcollection:type=requesthandler,name=handle-request"
            InstancePrefix "STREAM_requesthandler_"
            InstanceFrom "name"
            <Value>
                Type "counter"
                InstancePrefix "Count"
                #InstanceFrom ""
                Table false
                Attribute "Count"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "Max"
                #InstanceFrom ""
                Table false
                Attribute "Max"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "Mean"
                #InstanceFrom ""
                Table false
                Attribute "Mean"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "MeanRate"
                #InstanceFrom ""
                Table false
                Attribute "MeanRate"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "Min"
                #InstanceFrom ""
                Table false
                Attribute "Min"
            </Value>
        </MBean>
        <MBean "sc_request_handle_request_error">
            ObjectName "streamingcollection:type=requesthandler,name=handle-request-error"
            InstancePrefix "STREAM_requesthandler_"
            InstanceFrom "name"
            <Value>
                Type "gauge"
                InstancePrefix "Count"
                #InstanceFrom ""
                Table false
                Attribute "Count"
            </Value>
        </MBean>
        <MBean "sc_request_requests_handled">
            ObjectName "streamingcollection:type=requesthandler,name=requests-handled"
            InstancePrefix "STREAM_requesthandler_"
            InstanceFrom "name"
            <Value>
                Type "counter"
                InstancePrefix "Count"
                #InstanceFrom ""
                Table false
                Attribute "Count"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "MeanRate"
                #InstanceFrom ""
                Table false
                Attribute "MeanRate"
            </Value>
        </MBean>
        #####################
        # Connection blocks #
        #####################
        #Connection Block
        <Connection>
            Host "<%= @node[:hostname] %>"
            ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:<%= @node['wt_streamingcollection']['jmx_port'] %>/jmxrmi"
            Collect "sc_classes"
            Collect "sc_garbage_collector"
            Collect "sc_java_threads"
            Collect "sc_memory_heap"
            Collect "sc_memory_nonheap"
            Collect "sc_runtime"
            Collect "sc_kafka"
            Collect "sc_async"
            Collect "sc_kafka_router_handle_send_message_error"
            Collect "sc_kafka_router_messages_sent"
            Collect "sc_kafka_send_message"
            Collect "sc_request_handle_request"
            Collect "sc_request_handle_request_error"
            Collect "sc_request_requests_handled"
        </Connection>
        </Plugin>
</Plugin>


